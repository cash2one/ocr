{
  "html": "<h1 id=\"e72c8d67\">鉴权认证机制</h1><h2 id=\"b4f8ca58\">简介</h2><p>本文档主要针对HTTP API调用者，百度AIP开放平台使用OAuth2.0授权调用开放API，调用API时必须在URL中带上accesss_token参数，获取Access Token的流程如下：</p><h2 id=\"75d80ed1\">获取Access Token</h2><p><strong>请求URL数据格式</strong></p><p>向授权服务地址<code>https:<span class=\"hljs-regexp\">//</span>aip.baidubce.com<span class=\"hljs-regexp\">/oauth/</span><span class=\"hljs-number\">2.0</span><span class=\"hljs-regexp\">/token</span></code>发送请求（推荐使用POST），并在URL中带上以下参数：</p><ul><li><strong>grant_type：</strong> 必须参数，固定为<code>client_credentials</code>；</li><li><strong>client_id：</strong> 必须参数，应用的<code><span class=\"hljs-attribute\">API Key</span></code>；</li><li><strong>client_secret：</strong> 必须参数，应用的<code><span class=\"hljs-attribute\">Secret Key</span></code>；</li></ul><p>例如：</p><pre>\n<code class=\"hljs\" lang=\"\">https://aip.baidubce.com/oauth/<span class=\"hljs-number\">2.0</span>/token?\n    <span class=\"hljs-attr\">grant_type=client_credentials&amp;</span>\n    <span class=\"hljs-attr\">client_id=Va5yQRHlA4Fq4eR3LT0vuXV4&amp;</span>\n    <span class=\"hljs-attr\">client_secret=</span> <span class=\"hljs-number\">0</span>rDSjzQ20XUj5itV7WRtznPQSzr5pVw2&amp;</code>\n</pre><p><strong>获取access_token示例代码</strong></p><div class=\"code-block\"><div class=\"code-block-tab-container\"><div class=\"code-block-title block-active\" data-index=\"0\">bash</div><div class=\"code-block-title\" data-index=\"1\">PHP</div><div class=\"code-block-title\" data-index=\"2\">Java</div><div class=\"code-block-title\" data-index=\"3\">Python</div><div class=\"code-block-title\" data-index=\"4\">C++</div><div class=\"code-block-title\" data-index=\"5\">C#</div></div><div data-lan=\"bash\"><pre><code class=\"hljs\">curl -i -k <span class=\"hljs-string\">'https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=A0nyraL7kGXrDhfDf33UyGvX&amp;client_secret=4IGLoGQqeq8svpocetiBgzTLDlkVfhG1'</span>\n</code></pre></div><div data-lan=\"PHP\"><pre><code class=\"hljs\"><span class=\"hljs-meta\">&lt;?php</span>\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">request_post</span><span class=\"hljs-params\">($url = <span class=\"hljs-string\">''</span>, $param = <span class=\"hljs-string\">''</span>)</span> </span>{\n        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">empty</span>($url) || <span class=\"hljs-keyword\">empty</span>($param)) {\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;\n        }\n        \n        $postUrl = $url;\n        $curlPost = $param;\n        $curl = curl_init();<span class=\"hljs-comment\">//初始化curl</span>\n        curl_setopt($curl, CURLOPT_URL,$postUrl);<span class=\"hljs-comment\">//抓取指定网页</span>\n        curl_setopt($curl, CURLOPT_HEADER, <span class=\"hljs-number\">0</span>);<span class=\"hljs-comment\">//设置header</span>\n        curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class=\"hljs-number\">1</span>);<span class=\"hljs-comment\">//要求结果为字符串且输出到屏幕上</span>\n        curl_setopt($curl, CURLOPT_POST, <span class=\"hljs-number\">1</span>);<span class=\"hljs-comment\">//post提交方式</span>\n        curl_setopt($curl, CURLOPT_POSTFIELDS, $curlPost);\n        $data = curl_exec($curl);<span class=\"hljs-comment\">//运行curl</span>\n        curl_close($curl);\n        \n        <span class=\"hljs-keyword\">return</span> $data;\n    }\n\n\t$url = <span class=\"hljs-string\">'https://aip.baidubce.com/oauth/2.0/token'</span>;\n    $post_data[<span class=\"hljs-string\">'grant_type'</span>]       = <span class=\"hljs-string\">'client_credentials'</span>;\n    $post_data[<span class=\"hljs-string\">'client_id'</span>]      = <span class=\"hljs-string\">'A0nyraL7kGXrDhfDf33UyGvX'</span>;\n    $post_data[<span class=\"hljs-string\">'client_secret'</span>] = <span class=\"hljs-string\">'4IGLoGQqeq8svpocetiBgzTLDlkVfhG1'</span>;\n    $o = <span class=\"hljs-string\">\"\"</span>;\n    <span class=\"hljs-keyword\">foreach</span> ( $post_data <span class=\"hljs-keyword\">as</span> $k =&gt; $v ) \n    {\n    \t$o.= <span class=\"hljs-string\">\"$k=\"</span> . urlencode( $v ). <span class=\"hljs-string\">\"&amp;\"</span> ;\n    }\n    $post_data = substr($o,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">-1</span>);\n    \n    $res = request_post($url, $post_data);\n\n    var_dump($res);\n\n<span class=\"hljs-meta\">?&gt;</span></code></pre></div><div data-lan=\"Java\"><pre><code class=\"hljs\"><span class=\"hljs-keyword\">package</span> com.baidu.ai.aip.auth;\n\n<span class=\"hljs-keyword\">import</span> org.json.JSONObject;\n\n<span class=\"hljs-keyword\">import</span> java.io.BufferedReader;\n<span class=\"hljs-keyword\">import</span> java.io.InputStreamReader;\n<span class=\"hljs-keyword\">import</span> java.net.HttpURLConnection;\n<span class=\"hljs-keyword\">import</span> java.net.URL;\n<span class=\"hljs-keyword\">import</span> java.util.List;\n<span class=\"hljs-keyword\">import</span> java.util.Map;\n\n<span class=\"hljs-comment\">/**\n * 获取token类\n */</span>\n<span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AuthService</span> </span>{\n\n    <span class=\"hljs-comment\">/**\n     * 获取权限token\n     *\n     * <span class=\"hljs-doctag\">@return</span> 返回示例：\n     * {\n     * \"access_token\": \"24.460da4889caad24cccdb1fea17221975.2592000.1491995545.282335-9261443\",\n     * \"session_key\": \"9mzdDxLPLXYfhlmFRBSGI8jOy19HNzFT6cle3RWf2m9HL8LdLxyVhEETkPS8gQtLbhw1TP/ly3+l59n4wknbmwPk6NC1\",\n     * \"scope\": \"public vis-faceverify_faceverify vis-ocr_ocr vis-faceattribute_faceattribute vis-ocr_bankcard nlp_wordseg nlp_simnet nlp_wordemb nlp_comtag nlp_wordpos nlp_dnnlm_cn vis-antiporn_antiporn_v2 brain_ocr_scope wise_adapt lebo_resource_base lightservice_public hetu_basic lightcms_map_poi kaidian_kaidian wangrantest_test wangrantest_test1 bnstest_test1 bnstest_test2 ApsMisTest_Test权限 vis-classify_flower\",\n     * \"refresh_token\": \"25.bf1ec1814779878486cb9ba68f7defe5.315360000.1804763545.282335-9261443\",\n     * \"session_secret\": \"b292e183bb394fb8d8065e7f8b137757\",\n     * \"expires_in\": 2592000\n     * }\n     */</span>\n    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> String <span class=\"hljs-title\">getAuth</span><span class=\"hljs-params\">()</span> </span>{\n        <span class=\"hljs-comment\">// 获取token地址</span>\n        String authHost = <span class=\"hljs-string\">\"https://aip.baidubce.com/oauth/2.0/token?\"</span>;\n        <span class=\"hljs-comment\">// 官网获取的 API Key 更新为你注册的</span>\n        String clientId = <span class=\"hljs-string\">\"nElok3H1CINAdEsTuzwyxO9U\"</span>;\n        <span class=\"hljs-comment\">// 官网获取的 Secret Key 更新为你注册的</span>\n        String clientSecret = <span class=\"hljs-string\">\"kg1vwhls4LO5h91YZkfG58qpRWgFHFCl\"</span>;\n        String getAccessTokenUrl = authHost\n                <span class=\"hljs-comment\">// 1. grant_type为固定参数</span>\n                + <span class=\"hljs-string\">\"grant_type=client_credentials\"</span>\n                <span class=\"hljs-comment\">// 2. 官网获取的 API Key</span>\n                + <span class=\"hljs-string\">\"&amp;client_id=\"</span> + clientId\n                <span class=\"hljs-comment\">// 3. 官网获取的 Secret Key</span>\n                + <span class=\"hljs-string\">\"&amp;client_secret=\"</span> + clientSecret;\n        <span class=\"hljs-keyword\">try</span> {\n            URL realUrl = <span class=\"hljs-keyword\">new</span> URL(getAccessTokenUrl);\n            <span class=\"hljs-comment\">// 打开和URL之间的连接</span>\n            HttpURLConnection connection = (HttpURLConnection) realUrl.openConnection();\n            connection.setRequestMethod(<span class=\"hljs-string\">\"GET\"</span>);\n            connection.connect();\n            <span class=\"hljs-comment\">// 获取所有响应头字段</span>\n            Map&lt;String, List&lt;String&gt;&gt; map = connection.getHeaderFields();\n            <span class=\"hljs-comment\">// 遍历所有的响应头字段</span>\n            <span class=\"hljs-keyword\">for</span> (String key : map.keySet()) {\n                System.out.println(key + <span class=\"hljs-string\">\"---&gt;\"</span> + map.get(key));\n            }\n            <span class=\"hljs-comment\">// 定义 BufferedReader输入流来读取URL的响应</span>\n            BufferedReader in = <span class=\"hljs-keyword\">new</span> BufferedReader(<span class=\"hljs-keyword\">new</span> InputStreamReader(connection.getInputStream()));\n            String result = <span class=\"hljs-string\">\"\"</span>;\n            String line;\n            <span class=\"hljs-keyword\">while</span> ((line = in.readLine()) != <span class=\"hljs-keyword\">null</span>) {\n                result += line;\n            }\n            <span class=\"hljs-comment\">/**\n             * 返回结果示例\n             */</span>\n            System.out.println(<span class=\"hljs-string\">\"result:\"</span> + result);\n            JSONObject jsonObject = <span class=\"hljs-keyword\">new</span> JSONObject(result);\n            String access_token = jsonObject.getString(<span class=\"hljs-string\">\"access_token\"</span>);\n            <span class=\"hljs-keyword\">return</span> access_token;\n        } <span class=\"hljs-keyword\">catch</span> (Exception e) {\n            System.out.printf(<span class=\"hljs-string\">\"获取token失败！\"</span>);\n            e.printStackTrace();\n        }\n        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;\n    }\n}\n</code></pre></div><div data-lan=\"Python\"><pre><code class=\"hljs\"><span class=\"hljs-comment\"># encoding:utf-8</span>\n<span class=\"hljs-keyword\">import</span> urllib\n<span class=\"hljs-keyword\">import</span> urllib2\n<span class=\"hljs-keyword\">import</span> json\n\n\n<span class=\"hljs-function\"><span class=\"hljs-keyword\">def</span> <span class=\"hljs-title\">AuthService</span><span class=\"hljs-params\">()</span>:</span>\n    <span class=\"hljs-comment\"># 获取token地址</span>\n    authHost = <span class=\"hljs-string\">\"https://aip.baidubce.com/oauth/2.0/token?\"</span>\n    <span class=\"hljs-comment\"># 官网获取的 API Key</span>\n    clientId = <span class=\"hljs-string\">\"\"</span>\n    <span class=\"hljs-comment\"># 官网获取的 Secret Key</span>\n    clientSecret = <span class=\"hljs-string\">\"\"</span>\n    getAccessTokenUrl = authHost + <span class=\"hljs-string\">\"grant_type=client_credentials\"</span> + <span class=\"hljs-string\">\"&amp;client_id=\"</span> + clientId + <span class=\"hljs-string\">\"&amp;client_secret=\"</span> + clientSecret\n    request = urllib2.Request(getAccessTokenUrl)\n    response_data = urllib2.urlopen(request)\n    params = json.loads(response_data.read())\n    <span class=\"hljs-keyword\">return</span> params[<span class=\"hljs-string\">\"access_token\"</span>]\n\n\nAuthService()\n</code></pre></div><div data-lan=\"C++\"><pre><code class=\"hljs\">#include &lt;iostream&gt;\n#include &lt;curl/curl.h&gt;\n#include &lt;json/json.h&gt;\n#include \"access_token.h\"\n// libcurl库下载链接：https://curl.haxx.se/download.html\n// jsoncpp库下载链接：https://github.com/open-source-parsers/jsoncpp/\n// 获取access_token所需要的url\nconst std::string access_token_url = \"https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials\";\n// 回调函数获取到的access_token存放变量\nstatic std::string access_token_result;\n/**\n * curl发送http请求调用的回调函数，回调函数中对返回的json格式的body进行了解析，解析结果储存在result中\n * @param 参数定义见libcurl库文档\n * @return 返回值定义见libcurl库文档\n */\nstatic size_t callback(void *ptr, size_t size, size_t nmemb, void *stream) {\n    // 获取到的body存放在ptr中，先将其转换为string格式\n    std::string s((char *) ptr, size * nmemb);\n    // 开始获取json中的access token项目\n    Json::Reader reader;\n    Json::Value root;\n    // 使用boost库解析json\n    reader.parse(s,root);\n    access_token_result = root[\"access_token\"].asString();\n    return size * nmemb;\n}\n\n/**\n * 用以获取access_token的函数，使用时需要先在百度云控制台申请相应功能的应用，获得对应的API Key和Secret Key\n * @param access_token 获取得到的access token，调用函数时需传入该参数\n * @param AK 应用的API key\n * @param SK 应用的Secret key\n * @return 返回0代表获取access token成功，其他返回值代表获取失败\n */\nint get_access_token(std::string &amp;access_token, const std::string &amp;AK, const std::string &amp;SK) {\n    CURL *curl;\n    CURLcode result_code;\n    int success;\n    curl = curl_easy_init();\n    if (curl) {\n        curl_easy_setopt(curl, CURLOPT_URL,\n                         (access_token_url + \"&amp;client_id=\" + AK + \"&amp;client_secret=\" + SK).data());\n        curl_easy_setopt(curl, CURLOPT_WRITEFUNCTION, callback);\n        result_code = curl_easy_perform(curl);\n        if (result_code != CURLE_OK) {\n            fprintf(stderr, \"curl_easy_perform() failed: %s\\n\",\n                    curl_easy_strerror(result_code));\n            success = 1;\n            return success;\n        }\n        access_token = access_token_result;\n        curl_easy_cleanup(curl);\n        success = 0;\n    } else {\n        fprintf(stderr, \"curl_easy_init() failed.\");\n        success = 1;\n    }\n    return success;\n}\n</code></pre></div><div data-lan=\"C#\"><pre><code class=\"hljs\">﻿<span class=\"hljs-keyword\">using</span> System;\n<span class=\"hljs-keyword\">using</span> System.Collections.Generic;\n<span class=\"hljs-keyword\">using</span> System.Net.Http;\n\n<span class=\"hljs-keyword\">namespace</span> <span class=\"hljs-title\">com.baidu.ai</span>\n{\n\t<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">AccessToken</span>\n\n\t{\n\t\t<span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> String TOKEN = <span class=\"hljs-string\">\"######\"</span>; <span class=\"hljs-comment\">// 调用getAccessToken()获取的 access_token建议根据expires_in 时间 设置缓存</span>\n\n\t\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> String clientId = <span class=\"hljs-string\">\"####\"</span>; <span class=\"hljs-comment\">// 百度云中开通对应服务应用的 API Key 建议开通应用的时候多选服务</span>\n\t\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> String clientSecret = <span class=\"hljs-string\">\"#####\"</span>;   <span class=\"hljs-comment\">// 百度云中开通对应服务应用的 Secret Key</span>\n\n\t\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> String <span class=\"hljs-title\">getAccessToken</span>(<span class=\"hljs-params\"></span>) </span>{\n\t\t\tString authHost = <span class=\"hljs-string\">\"https://aip.baidubce.com/oauth/2.0/token\"</span>;\n\t\t\tHttpClient client = <span class=\"hljs-keyword\">new</span> HttpClient();\n\t\t\tList&lt;KeyValuePair&lt;String, String&gt;&gt; paraList = <span class=\"hljs-keyword\">new</span> List&lt;KeyValuePair&lt;<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-keyword\">string</span>&gt;&gt;();\n\t\t\tparaList.Add(<span class=\"hljs-keyword\">new</span> KeyValuePair&lt;<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-keyword\">string</span>&gt;(<span class=\"hljs-string\">\"grant_type\"</span>, <span class=\"hljs-string\">\"client_credentials\"</span>));\n\t\t\tparaList.Add(<span class=\"hljs-keyword\">new</span> KeyValuePair&lt;<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-keyword\">string</span>&gt;(<span class=\"hljs-string\">\"client_id\"</span>, clientId));\n\n\t\t\tparaList.Add(<span class=\"hljs-keyword\">new</span> KeyValuePair&lt;<span class=\"hljs-keyword\">string</span>, <span class=\"hljs-keyword\">string</span>&gt;(<span class=\"hljs-string\">\"client_secret\"</span>, clientSecret));\n\n\t\t\tHttpResponseMessage response = client.PostAsync(authHost, <span class=\"hljs-keyword\">new</span> FormUrlEncodedContent(paraList)).Result;\n\t\t\tString result = response.Content.ReadAsStringAsync().Result;\n\t\t\tConsole.WriteLine(result);\n\t\t\t<span class=\"hljs-comment\">// </span>\n\t\t\t<span class=\"hljs-keyword\">return</span> result;\n\t\t}\n\t}\n}\n</code></pre></div></div><blockquote><p><strong>说明：</strong>方式一鉴权使用的Access_token必须通过API Key和Secret Key获取。</p></blockquote><p><strong>服务器返回的JSON文本参数如下：</strong></p><ul><li><strong>access_token：</strong>要获取的Access Token；</li><li><strong>expires_in：</strong>Access Token的有效期(秒为单位，一般为1个月)；</li><li><strong>其他参数忽略，暂时不用</strong>;</li></ul><p>例如：</p><pre>\n<code class=\"hljs\" lang=\"\">{\n  <span class=\"hljs-attr\">\"refresh_token\"</span>: <span class=\"hljs-string\">\"25.b55fe1d287227ca97aab219bb249b8ab.315360000.1798284651.282335-8574074\"</span>,\n  <span class=\"hljs-attr\">\"expires_in\"</span>: <span class=\"hljs-number\">2592000</span>,\n  <span class=\"hljs-attr\">\"scope\"</span>: <span class=\"hljs-string\">\"public wise_adapt\"</span>,\n  <span class=\"hljs-attr\">\"session_key\"</span>: <span class=\"hljs-string\">\"9mzdDZXu3dENdFZQurfg0Vz8slgSgvvOAUebNFzyzcpQ5EnbxbF+hfG9DQkpUVQdh4p6HbQcAiz5RmuBAja1JJGgIdJI\"</span>,\n  <span class=\"hljs-attr\">\"access_token\"</span>: <span class=\"hljs-string\">\"24.6c5e1ff107f0e8bcef8c46d3424a0e78.2592000.1485516651.282335-8574074\"</span>,\n  <span class=\"hljs-attr\">\"session_secret\"</span>: <span class=\"hljs-string\">\"dfac94a3489fe9fca7c3221cbf7525ff\"</span>\n}</code>\n</pre><p><strong>若请求错误，服务器将返回的JSON文本包含以下参数：</strong></p><ul><li><p><strong>error：</strong>错误码；关于错误码的详细信息请参考下方鉴权认证错误码。</p></li><li><p><strong>error_description：</strong>错误描述信息，帮助理解和解决发生的错误。</p></li></ul><p><strong>例如认证失败返回：</strong></p><pre>\n<code class=\"hljs\" lang=\"\">{\n    <span class=\"hljs-attr\">\"error\"</span>: <span class=\"hljs-string\">\"invalid_client\"</span>,\n    <span class=\"hljs-attr\">\"error_description\"</span>: <span class=\"hljs-string\">\"unknown client id\"</span>\n}</code>\n</pre><p><strong>鉴权认证错误码</strong></p><table><thead><tr><th>error</th><th>error_description</th><th>解释</th></tr></thead><tbody><tr><td>invalid_client</td><td>unknown client id</td><td>API Key不正确</td></tr><tr><td>invalid_client</td><td>Client authentication failed</td><td>Secret Key不正确</td></tr></tbody></table><h2 id=\"9d0f74c9\">使用Access Key ID/Secret Access Key的开发者注意</h2><p>如果您使用的是“安全认证/Access Key ”中的Access Key ID 和 Secret Access Key的开发者，则不能使用获取Access Token的方式鉴权，具体鉴权认证机制参考“<a href=\"https://cloud.baidu.com/doc/Reference/AuthenticationMechanism.html\" target=\"_blank\">百度云鉴权认证机制</a>”。</p>",
  "headings": [
    {
      "level": 1,
      "text": "鉴权认证机制",
      "id": "e72c8d67"
    },
    {
      "level": 2,
      "text": "简介",
      "id": "b4f8ca58"
    },
    {
      "level": 2,
      "text": "获取Access Token",
      "id": "75d80ed1"
    },
    {
      "level": 2,
      "text": "使用Access Key ID/Secret Access Key的开发者注意",
      "id": "9d0f74c9"
    }
  ]
}
